"use strict";(self.webpackChunkstock_analyzer=self.webpackChunkstock_analyzer||[]).push([[793],{7793:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var r=a(9379),s=a(5043),n=a(108),o=a(6992),l=a(6102),c=a(7869),i=a(379),d=a(877),h=a(7734),u=a(2185),m=a(760),f=a(95),p=a(5963),y=a(579);const g=["#00bfff","#32cd32","#ffdf00","#ff4d4d","#7c3aed","#14b8a6","#c026d3","#e11d48"],x=[{name:"Yahoo Finance",url:e=>"https://query1.finance.yahoo.com/v7/finance/quote?symbols=".concat(e),extractPrice:e=>{var t,a,r;return(null===(t=e.quoteResponse)||void 0===t||null===(a=t.result)||void 0===a||null===(r=a[0])||void 0===r?void 0:r.regularMarketPrice)||0}},{name:"Alpha Vantage (Demo)",url:e=>"https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=".concat(e,"&apikey=demo"),extractPrice:e=>{var t;return parseFloat(null===(t=e["Global Quote"])||void 0===t?void 0:t["05. price"])||0}}],j=async e=>{for(const a of x)try{console.log("Trying ".concat(a.name," for ").concat(e,"..."));const t=await fetch(a.url(e));if(!t.ok){console.warn("".concat(a.name," failed for ").concat(e,": ").concat(t.status));continue}const r=await t.json(),s=a.extractPrice(r);if(s>0)return console.log("Successfully fetched price for ".concat(e,": $").concat(s," from ").concat(a.name)),s}catch(t){console.warn("Error fetching from ".concat(a.name,":"),t);continue}return console.error("Failed to fetch price for ".concat(e," from all APIs")),0},b={},k=async e=>{if(b[e])return b[e];try{const t=await fetch("".concat("/stock-2.0","/stock-data/").concat(e,".json"));if(!t.ok)return console.warn("Could not find local data for ".concat(e,". Status: ").concat(t.status)),null;const a=(await t.json()).map(e=>({date:new Date(e.Date).toISOString().split("T")[0],close:e.Close})).filter(e=>e.close>0);return b[e]=a,a}catch(t){return console.error("Error loading local historical data for ".concat(e,":"),t),null}},v=()=>{const[e,t]=(0,s.useState)(()=>{try{const e=localStorage.getItem("portfolio");return e?JSON.parse(e):[]}catch(S){return console.error("Error loading portfolio from localStorage:",S),[]}}),[a,x]=(0,s.useState)({symbol:"",shares:""}),[b,v]=(0,s.useState)(!1),[S,w]=(0,s.useState)(""),[N,D]=(0,s.useState)([]),[P,F]=(0,s.useState)(!1),[A,C]=(0,s.useState)("1y"),[E,R]=(0,s.useState)(!1),[L,U]=(0,s.useState)(null);(0,s.useEffect)(()=>{try{localStorage.setItem("portfolio",JSON.stringify(e))}catch(S){console.error("Error saving portfolio to localStorage:",S)}},[e]);const T=async()=>{const r=a.symbol.toUpperCase().trim(),s=Number(a.shares);if(r)if(s<=0||isNaN(s))w("Please enter a valid number of shares");else if(e.some(e=>e.symbol===r))w("This stock is already in your portfolio");else{w(""),v(!0);try{let e=await j(r);if(e<=0){console.log("Live price fetch failed for ".concat(r,". Trying local historical data as fallback."));const t=await k(r);t&&t.length>0&&(e=t[t.length-1].close,console.log("Using latest price from local data for ".concat(r,": $").concat(e)))}if(e>0){const a={symbol:r,shares:s,price:e};t(e=>[...e,a]),x({symbol:"",shares:""}),console.log("Added ".concat(r,": ").concat(s," shares at $").concat(e))}else w("Could not fetch price for ".concat(r,". Please check the symbol and the local data file."))}catch(S){console.error("Error adding holding:",S),w("Failed to add stock. Please try again.")}finally{v(!1)}}else w("Please enter a stock symbol")},V=(0,s.useMemo)(()=>e.reduce((e,t)=>e+t.price*t.shares,0),[e]),Y=(0,s.useMemo)(()=>0===V?[]:e.map(e=>({name:e.symbol,value:e.price*e.shares,percentage:(e.price*e.shares/V*100).toFixed(1)})),[e,V]),O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:t,maximumFractionDigits:t}).format(e)},B=(0,s.useMemo)(()=>{if(N.length<2)return null;const e=N[0].totalValue,t=N[N.length-1].totalValue,a=(t-e)/e*100,r=(new Date(N[N.length-1].date)-new Date(N[0].date))/864e5;if(0===r)return null;let s;return s="1y"===A?a:100*((t/e)**(365/r)-1),{totalReturn:a.toFixed(2),annualizedReturn:s.toFixed(2),initialValue:e,finalValue:t,gain:t-e}},[N,A]);return(0,y.jsxs)("div",{className:"portfolio-tracker",children:[(0,y.jsxs)("div",{className:"pt-header",children:[(0,y.jsx)("h1",{children:"Portfolio Tracker"}),(0,y.jsx)("p",{children:"Track your investment portfolio performance with historical backtesting"})]}),(0,y.jsxs)("div",{className:"pt-main-content",children:[S&&(0,y.jsx)("div",{className:"pt-error",children:S}),(0,y.jsxs)("div",{className:"pt-inputs",children:[(0,y.jsx)("input",{type:"text",placeholder:"Stock Symbol (e.g., AAPL)",value:a.symbol,onChange:e=>x((0,r.A)((0,r.A)({},a),{},{symbol:e.target.value})),onKeyPress:e=>"Enter"===e.key&&T()}),(0,y.jsx)("input",{type:"number",placeholder:"Number of Shares",value:a.shares,onChange:e=>x((0,r.A)((0,r.A)({},a),{},{shares:e.target.value})),onKeyPress:e=>"Enter"===e.key&&T(),min:"0",step:"1"}),(0,y.jsx)("button",{onClick:T,disabled:b,children:b?"Adding...":"Add Stock"})]}),e.length>0&&(0,y.jsxs)("div",{className:"pt-actions",children:[(0,y.jsx)("button",{onClick:async()=>{v(!0),w("");try{const a=await Promise.all(e.map(async e=>{const t=await j(e.symbol);return(0,r.A)((0,r.A)({},e),{},{price:t>0?t:e.price})}));t(a),console.log("Updated all stock prices")}catch(S){console.error("Error updating prices:",S),w("Failed to update prices. Please try again.")}finally{v(!1)}},disabled:b||P,className:"pt-update-btn",children:b?"Updating...":"Update Prices"}),(0,y.jsxs)("div",{className:"pt-backtest-controls",children:[(0,y.jsx)("label",{htmlFor:"backtest-period",children:"Backtest Period:"}),(0,y.jsx)("div",{className:"portfolio-input-group",children:(0,y.jsxs)("select",{id:"backtest-period",value:A,onChange:e=>C(e.target.value),children:[(0,y.jsx)("option",{value:"1y",children:"1 Year"}),(0,y.jsx)("option",{value:"5y",children:"5 Years"}),(0,y.jsx)("option",{value:"10y",children:"10 Years"}),(0,y.jsx)("option",{value:"20y",children:"20 Years"}),(0,y.jsx)("option",{value:"max",children:"Max"})]})}),(0,y.jsx)("button",{onClick:async()=>{if(0!==e.length){F(!0),w(""),R(!1);try{const t=e.map(async e=>{const t=await k(e.symbol);return{symbol:e.symbol,data:t,shares:e.shares}}),a=(await Promise.all(t)).filter(e=>e.data&&e.data.length>0);if(0===a.length)return w("Could not load local historical data for any of your stocks. Please ensure the JSON files exist in /public/stock-data/."),void F(!1);if(a.length<e.length){const t=e.filter(e=>!a.find(t=>t.symbol===e.symbol)).map(e=>e.symbol);w("Warning: Could not load local data for ".concat(t.join(", "),". Backtest will run with the remaining stocks."))}const s=((e,t)=>{const a=new Date;if("max"===e){let e=null;return t.forEach(t=>{if(t.data&&t.data.length>0){const a=new Date(t.data[0].date);(!e||a>e)&&(e=a)}}),(e||new Date((new Date).setFullYear(a.getFullYear()-1))).toISOString().split("T")[0]}const r={"1y":1,"5y":5,"10y":10,"20y":20}[e]||1,s=new Date;return s.setFullYear(a.getFullYear()-r),s.toISOString().split("T")[0]})(A,a),n=a.map(e=>(0,r.A)((0,r.A)({},e),{},{data:e.data.filter(e=>e.date>=s)})).filter(e=>e.data.length>0),o=new Set;n.forEach(e=>{e.data.forEach(e=>o.add(e.date))});const l=Array.from(o).sort().map(e=>{let t=0,a=!1;for(const r of n){const s=r.data.find(t=>t.date===e);if(s&&s.close>0)t+=s.close*r.shares;else{const s=r.data.slice().reverse().find(t=>new Date(t.date)<=new Date(e)&&t.close>0);if(!s){a=!0;break}t+=s.close*r.shares}}return a?null:{date:e,totalValue:t,formattedDate:new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}}).filter(e=>null!==e&&e.totalValue>0);if(l.length<2)w("Not enough historical data in the selected period to create a meaningful backtest. Try a longer period."),D([]),U(null);else{D(l),R(!0);const e=l[0].date,t=l[l.length-1].date;U({startDate:e,endDate:t,requestedStartDate:s,isLimited:e>s,period:A}),console.log("Backtest completed with ".concat(l.length," data points"))}}catch(S){console.error("Error running backtest:",S),w("Failed to run backtest. Please try again.")}finally{F(!1)}}else w("Please add some stocks to your portfolio first")},disabled:P||b,className:"pt-backtest-btn",children:P?"Running Backtest...":"Run Backtest"})]})]}),(0,y.jsxs)("div",{className:"pt-content-grid",children:[(0,y.jsxs)("div",{className:"pt-table",children:[(0,y.jsx)("h3",{children:"Your Holdings"}),(0,y.jsxs)("table",{children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{children:"Symbol"}),(0,y.jsx)("th",{children:"Shares"}),(0,y.jsx)("th",{children:"Price"}),(0,y.jsx)("th",{children:"Value"}),(0,y.jsx)("th",{})]})}),(0,y.jsx)("tbody",{children:e.map((e,a)=>(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"pt-symbol",children:e.symbol}),(0,y.jsx)("td",{children:e.shares.toLocaleString()}),(0,y.jsx)("td",{children:O(e.price)}),(0,y.jsx)("td",{children:O(e.price*e.shares)}),(0,y.jsx)("td",{children:(0,y.jsx)("button",{onClick:()=>(e=>{t(t=>t.filter((t,a)=>a!==e))})(a),className:"pt-delete-btn",title:"Remove stock",disabled:P||b,children:"\xd7"})})]},a))})]})]}),(0,y.jsxs)("div",{className:"pt-chart",children:[(0,y.jsx)("h3",{children:"Portfolio Allocation"}),Y.length>0?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(n.u,{width:"100%",height:300,children:(0,y.jsxs)(o.r,{children:[(0,y.jsx)(l.F,{data:Y,dataKey:"value",nameKey:"name",outerRadius:100,label:e=>{let{name:t,percentage:a}=e;return"".concat(t," ").concat(a,"%")},children:Y.map((e,t)=>(0,y.jsx)(c.f,{fill:g[t%g.length]},"cell-".concat(t)))}),(0,y.jsx)(i.m,{formatter:e=>O(e,2),labelFormatter:e=>e})]})}),(0,y.jsxs)("p",{className:"pt-total",children:["Total Portfolio Value: ",O(V,0)]})]}):(0,y.jsxs)("div",{className:"pt-empty",children:[(0,y.jsx)("p",{children:"No stocks in your portfolio yet."}),(0,y.jsx)("p",{children:"Add some stocks above to get started!"})]})]})]}),E&&N.length>0&&(0,y.jsxs)("div",{className:"pt-backtest-section",children:[(0,y.jsxs)("h3",{children:["Historical Performance (",A,")"]}),L&&(0,y.jsxs)("div",{className:"pt-date-range-note ".concat(L.isLimited?"limited":""),children:[(0,y.jsx)("span",{className:"pt-date-range-icon",children:"\ud83d\udcc5"}),(0,y.jsx)("span",{children:L.isLimited?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("strong",{children:"Limited by available data:"})," Backtest runs from"," ",new Date(L.startDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})," to"," ",new Date(L.endDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}):(0,y.jsxs)(y.Fragment,{children:["Backtest period: ",new Date(L.startDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})," to"," ",new Date(L.endDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]})})]}),B&&(0,y.jsxs)("div",{className:"pt-performance-summary",children:[(0,y.jsxs)("div",{className:"pt-performance-card",children:[(0,y.jsx)("span",{className:"pt-performance-label",children:"Total Return"}),(0,y.jsxs)("span",{className:"pt-performance-value ".concat(B.totalReturn>=0?"positive":"negative"),children:[B.totalReturn>=0?"+":"",B.totalReturn,"%"]})]}),(0,y.jsxs)("div",{className:"pt-performance-card",children:[(0,y.jsx)("span",{className:"pt-performance-label",children:"Annualized Return"}),(0,y.jsxs)("span",{className:"pt-performance-value ".concat(B.annualizedReturn>=0?"positive":"negative"),children:[B.annualizedReturn>=0?"+":"",B.annualizedReturn,"%"]})]})]}),(0,y.jsx)("div",{className:"pt-backtest-chart",children:(0,y.jsx)(n.u,{width:"100%",height:400,children:(0,y.jsxs)(d.Q,{data:N,children:[(0,y.jsx)(h.d,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),(0,y.jsx)(u.W,{dataKey:"formattedDate",tick:{fill:"#ccc"},interval:"preserveStartEnd"}),(0,y.jsx)(m.h,{tick:{fill:"#ccc"},tickFormatter:e=>O(e,0),domain:["dataMin","dataMax"]}),(0,y.jsx)(i.m,{formatter:e=>O(e,2),labelFormatter:e=>"Date: ".concat(e)}),(0,y.jsx)(f.s,{}),(0,y.jsx)(p.Gk,{type:"monotone",dataKey:"totalValue",name:"Portfolio Value",stroke:"#00bfff",fill:"#00bfff",fillOpacity:.3})]})})})]})]})]})}}}]);
//# sourceMappingURL=793.5fa7550e.chunk.js.map